
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>splendor.api &#8212; Splendor 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for splendor.api</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="k">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">PurePosixPath</span>

<span class="kn">from</span> <span class="nn">.schema</span> <span class="k">import</span> <span class="n">Schematic</span><span class="p">,</span> <span class="n">Configurable</span><span class="p">,</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">.operation</span> <span class="k">import</span> <span class="n">Operation</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">RequestBody</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Link</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">common</span>
<span class="kn">from</span> <span class="nn">.data</span> <span class="k">import</span> <span class="n">DataKey</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="k">import</span> <span class="n">get_schema</span><span class="p">,</span> <span class="n">build_parameters</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">current_app</span><span class="p">,</span> <span class="n">request</span>


<span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The identifying name of the contact person/organization.&quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The URL pointing to the contact information. MUST be in the format of a URL.&quot;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="s2">&quot;The email address of the contact person/organization. MUST be in the format of an email address.&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">License</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The license name used for the API.&quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;A URL to the license used for the API. MUST be in the format of a URL.&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Server</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ExternalDoc</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;A short description of the target documentation. CommonMark syntax MAY be used for rich text representation.&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The URL for the target documentation. Value MUST be in the format of a URL.&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Info</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The title of the application.&quot;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;A short description of the application. CommonMark syntax MAY be used for rich text representation.&quot;</span><span class="p">)</span>
    <span class="n">terms_of_service</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;A URL to the Terms of Service for the API. MUST be in the format of a URL.&quot;</span><span class="p">)</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Contact</span><span class="p">)</span>
    <span class="n">license</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">License</span><span class="p">)</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The version of the OpenAPI document (which is distinct from the OpenAPI Specification version or the API implementation version).&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">OAuthFlow</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">authorization_url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The authorization URL to be used for this flow. This MUST be in the form of a URL.&quot;</span><span class="p">)</span>
    <span class="n">token_url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The token URL to be used for this flow. This MUST be in the form of a URL.&quot;</span><span class="p">)</span>
    <span class="n">refresh_url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;The URL to be used for obtaining refresh tokens. This MUST be in the form of a URL.&#39;</span><span class="p">)</span>
    <span class="n">scopes</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The available scopes for the OAuth2 security scheme. A map between the scope name and a short description for it.&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">OAuthFlowSet</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">implicit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">OAuthFlow</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Configuration for the OAuth Implicit flow&quot;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">OAuthFlow</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Configuration for the OAuth Resource Owner Password flow&quot;</span><span class="p">)</span>
    <span class="n">client_credentials</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">OAuthFlow</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Configuration for the OAuth Client Credentials flow. Previously called application in OpenAPI 2.0.&quot;</span><span class="p">)</span>
    <span class="n">authorization_code</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">OAuthFlow</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Configuration for the OAuth Authorization Code flow. Previously called accessCode in OpenAPI 2.0.&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SecurityScheme</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Enum</span><span class="p">([</span><span class="s2">&quot;apiKey&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">,</span> <span class="s2">&quot;openIdConnect&quot;</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The type of the security scheme.&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;A short description for security scheme. CommonMark syntax MAY be used for rich text representation.&quot;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;The name of the header, query or cookie parameter to be used.&#39;</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Enum</span><span class="p">([</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;cookie&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The location of the API key.&#39;</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">scheme</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the HTTP Authorization scheme to be used in the Authorization header as defined in RFC7235.&quot;</span><span class="p">)</span>
    <span class="n">bearerFormat</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;A hint to the client to identify how the bearer token is formatted. Bearer tokens are usually generated by an authorization server, so this information is primarily for documentation purposes.&quot;</span><span class="p">)</span>
    <span class="n">flows</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">OAuthFlowSet</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;An object containing configuration information for the flow types supported.&quot;</span><span class="p">)</span>
    <span class="n">open_id_connect_url</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;OpenId Connect URL to discover OAuth2 configuration values. This MUST be in the form of a URL.&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Short description for the example.&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Long description for the example. CommonMark syntax MAY be used for rich text representation.&#39;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Embedded literal example. The value field and externalValue field are mutually exclusive. To represent examples of media types that cannot naturally represented in JSON or YAML, use a string value to contain the example, escaping where necessary.&#39;</span><span class="p">)</span>
    <span class="n">external_value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">URIString</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;A URL that points to the literal example. This provides the capability to reference examples that cannot easily be included in JSON or YAML documents. The value field and externalValue field are mutually exclusive.&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PathItem</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">put</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Operation</span><span class="p">)</span>
    <span class="n">servers</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Server</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Collection</span><span class="p">):</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Fix me&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Operation</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">obj</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Callable</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="n">Operation</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Operation</span><span class="p">):</span>
                <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
                <span class="n">v</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="n">first_registration</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Components</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">SchemaField</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Response</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Example</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">request_bodies</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Header</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">security_schemes</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">SecurityScheme</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Link</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">PathItem</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Parameter</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The name of the tag.&#39;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;A short description for the tag. CommonMark syntax MAY be used for rich text representation.&#39;</span><span class="p">)</span>
    <span class="n">external_docs</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">ExternalDoc</span><span class="p">)</span>

<div class="viewcode-block" id="Collection"><a class="viewcode-back" href="../../collections.html#splendor.api.Collection">[docs]</a><span class="k">class</span> <span class="nc">Collection</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A collection is a Splendor specific construct that describes a group of operations that have a common schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">SchemaField</span><span class="p">()</span>
    <span class="n">auditor</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Duck</span><span class="p">([</span><span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">])</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">Field</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;/&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="s1">&#39;list_items&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;post&#39;</span><span class="p">:</span> <span class="s1">&#39;post_item&#39;</span><span class="p">},</span>
        <span class="s1">&#39;/&lt;id&gt;&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="s1">&#39;get_item&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;put&#39;</span><span class="p">:</span> <span class="s1">&#39;put_item&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;patch&#39;</span><span class="p">:</span> <span class="s1">&#39;patch_item&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;delete&#39;</span><span class="p">:</span> <span class="s1">&#39;delete_item&#39;</span><span class="p">}</span>
    <span class="p">})</span>
    <span class="n">url_prefix</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">PurePosixPath</span><span class="p">,</span> <span class="n">export</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">### Meta ###</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.__class__}</span><span class="s1">(</span><span class="si">{self.title}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">register_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url_prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">OperationTemplate</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">Operation</span><span class="p">):</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">operation_id</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">:</span><span class="si">{fn.__name__}</span><span class="s1">&#39;</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="n">first_registration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span><span class="n">callable</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> 
                           <span class="n">operation_id</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">:</span><span class="si">{fn.__name__}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">method</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;methods&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                           <span class="n">parameters</span><span class="o">=</span><span class="n">build_parameters</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)),</span>
                           <span class="n">description</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="n">first_registration</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url_prefix</span> <span class="o">=</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url_prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">mapping_or_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_prefix</span> <span class="o">/</span> <span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mapping_or_fn</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">view_func</span> <span class="ow">in</span> <span class="n">mapping_or_fn</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">register_operation</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">view_func</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="n">first_registration</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_operation</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">mapping_or_fn</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="n">first_registration</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1">### Interface ###</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">partial</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">filters</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">filters</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">audit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auditor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">enrich</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">enrich_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span>


    <span class="c1">### Operations ###</span>
    <span class="nd">@common</span><span class="o">.</span><span class="n">listing</span>
    <span class="k">def</span> <span class="nf">list_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enrich_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">))</span>
    
    <span class="nd">@common</span><span class="o">.</span><span class="n">post</span>
    <span class="k">def</span> <span class="nf">post_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    
    <span class="nd">@common</span><span class="o">.</span><span class="n">get</span>
    <span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">DataKey</span><span class="p">(</span><span class="n">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;get:key&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">404</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;get:item&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    
    <span class="nd">@common</span><span class="o">.</span><span class="n">put</span>
    <span class="k">def</span> <span class="nf">put_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PUT ITEM&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">DataKey</span><span class="p">(</span><span class="n">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;put&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PUT ITEM 2&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    
    <span class="nd">@common</span><span class="o">.</span><span class="n">patch</span>
    <span class="k">def</span> <span class="nf">patch_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">DataKey</span><span class="p">(</span><span class="n">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    
    <span class="nd">@common</span><span class="o">.</span><span class="n">delete</span>
    <span class="k">def</span> <span class="nf">delete_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">DataKey</span><span class="p">(</span><span class="n">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="n">Configurable</span><span class="p">):</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Collection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">filters</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Api</span><span class="p">(</span><span class="n">Schematic</span><span class="p">):</span>
    <span class="n">openapi</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;3.0.1&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;This string MUST be the semantic version number of the OpenAPI Specification version that the OpenAPI document uses. The openapi field SHOULD be used by tooling specifications and clients to interpret the OpenAPI document. This is not related to the API info.version string.&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Info</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Provides metadata about the API. The metadata MAY be used by tooling as required.&#39;</span><span class="p">)</span>
    <span class="n">servers</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Server</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;An array of Server Objects, which provide connectivity information to a target server. If the servers property is not provided, or is an empty array, the default value would be a Server Object with a url value of /.&#39;</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">PathItem</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The available paths and operations for the API.&#39;</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Components</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;An element to hold various schemas for the specification.&#39;</span><span class="p">)</span>
    <span class="n">security</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">},</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A declaration of which security mechanisms can be used across the API. The list of values includes alternative security requirement objects that can be used. Only one of the security requirement objects need to be satisfied to authorize a request. Individual operations can override this definition.&#39;</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A list of tags used by the specification with additional metadata. The order of the tags can be used to reflect on their order by the parsing tools. Not all tags that are used by the Operation Object must be declared. The tags that are not declared MAY be organized randomly or based on the tools</span><span class="se">\&#39;</span><span class="s1"> logic. Each tag name in the list MUST be unique.&#39;</span><span class="p">)</span>
    <span class="n">external_docs</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">ExternalDoc</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A list of external doc objects to reference.&quot;</span><span class="p">)</span>
    <span class="n">swagger_path</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;swagger&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The relative url path from our base that should respond with an embedded swagger app.  Set to None to disable this feature.&quot;</span><span class="p">)</span>
    <span class="n">spec_path</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;openapi.json&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The relative url path from our base that should respond with our open api json document.  Set to None to disable this feature.&quot;</span><span class="p">)</span>
    <span class="n">_url_prefix</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">PurePosixPath</span><span class="p">,</span> <span class="n">export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The prefix that this API lives at in the flask App.&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">_collections</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">InstanceOf</span><span class="p">(</span><span class="n">Collection</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;All collections registered to the api.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url_prefix</span> <span class="o">=</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url_prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">resource</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url_prefix</span> <span class="o">/</span> <span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span><span class="p">()</span>

            <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="o">=</span><span class="n">first_registration</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">Collection</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span><span class="p">[</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url_prefix</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec_path</span><span class="p">),</span> <span class="n">view_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec_view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swagger_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url_prefix</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">swagger_path</span><span class="p">),</span> <span class="n">view_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">swagger_view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">first_registration</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">jinja2</span><span class="o">,</span> <span class="nn">os</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">jinja_loader</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">ChoiceLoader</span><span class="p">([</span>
                <span class="n">app</span><span class="o">.</span><span class="n">jinja_loader</span><span class="p">,</span>
                <span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;templates&#39;</span> <span class="p">)])</span>
            <span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{self.info.title}</span><span class="s2">_</span><span class="si">{self.info.version}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="nf">spec_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marshal_as</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;SPLENDOR_ADD_SERVERS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{url.scheme}</span><span class="s1">://</span><span class="si">{url.netloc}{self._url_prefix}</span><span class="s1">&#39;</span>
            <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;servers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;servers&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;This Server&#39;</span><span class="p">}]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;servers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;servers&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SPLENDOR_ADD_SERVERS&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">swagger_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;swagger.html&#39;</span><span class="p">,</span> <span class="n">spec_url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url_prefix</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec_path</span><span class="p">))</span>



<span class="c1"># TODO: </span>
<span class="c1"># Register API</span>
<span class="c1"># Datastore</span>
<span class="c1"># Extra posts</span>
<span class="c1"># Security</span>
<span class="c1"># Responses</span>
<span class="c1"># Respond sensitive to Accept</span>
<span class="c1"># Export</span>
<span class="c1"># Figure out Changelogs</span>
<span class="c1"># Figure out communication management</span>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Splendor</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schema.html">Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versioning.html">Versioning</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../organic.html">Organic Development</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, ForgeWorks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>